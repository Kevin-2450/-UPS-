# 内置电池的SK150C桌面电源

#### 介绍
给自己DIY的内置电池的SK150C桌面电源写的固件。

#### 开源硬件
 https://oshwhub.com/kevin1415926/sk150c-expansion-board-four-stri

## 项目简介
本项目是以STM32F030F4P6作为EC，HUSB238作为协议芯片取电，SC8886S作为充电/电源路径管理芯片，以BM3451作为锂电池保护和均压芯片。虽然是作为SK150C的拓展板来设计的，其实实际上达到了一个UPS电源的效果。
V2版本，相较V1硬件软件都有所改动：
* RY9121更换为RY8411；
* 增加散热风扇，散热风扇尺寸为2507，风扇驱动电压为5V；
* 重建3D外壳减小整体尺寸；
* 侧面引出复位按键；
* 电池组不再绑定在PCB上。另外采用了一个4串一并的21700锂电池组，散热和灵活性更加优秀。

## 项目参数和功能

* 左侧两个C口靠后的是充电口，靠前的一个连接到了CH342K，这个芯片的两个串口，分别连接到EC（COM19）和SK150C（COM15）连接到EC的串口可以读取充放电信息以及适配器信息，连接到SK150C的串口可以连接到SK150C的上位机玩；
* 正面的按键是开关，按下之后SK150C会上电并且按键会亮起；
* 本项目固件中自动使用HUSB238向适配器动态申请最高电压，并且根据适配器输入出电流能力设置输入限流；
* 由SC8886S自动完成电源路径动态管理；
* 实测V2版本在有风扇辅助散热的情况下最大充电功率可以达到100W；
* 两个LED实现简单的充电指示，当充电电流>=0.1A的时候左侧LED常亮表示正在充电，当充电电流<0.1A的时候充电截至（即充满）右侧LED常亮；
* 拔出电源适配器的时候系统进入低功耗模式，单片机本身进入stop模式，暂时没有测低功耗模式续航；
* BM3451电池保护芯片对四节电池进行均压和过充过放过流保护；
* 外壳在两个C口边上留了复位按键的小孔，在出现意外的错误的时候可以复位主控。


## 软件代码
代码请移步：
gitee地址：https://gitee.com/Xiao_Hang123/UPS_SC8886S_STM32F030.git
github地址https://github.com/Kevin-2450/-UPS-.git
模型文件一并保存在这个项目中，使用catia画的

## 注意事项

* 电源芯片SC8886和SC8886S不能在这里混用，用SC8886会导致DCDC电路震荡，需要修改RC补偿网络我尝试过几组值但是没有成功.
* PCB上R12是NTC电阻，需要10KB值为3950的热敏电阻，如果不需要温度保护功能则在PCB正面R12的地方焊一个10K的电阻，如果需要温度保护功能则正面的R12留空，背面有NTC电阻的焊盘在那里焊上NTC电阻然后把NTC电阻贴到电池组上；
* 电池刚装上去或者电池拆下来又装上去之后BM3451会进入保护状态，需要先插入STlink给单片机供电然后插入电源适配器进入一下充电状态激活电池组。拔下stlink之后再次插入适配器如果充电指示灯正常亮起那么应该正常激活了


## 组装流程
* PCB装之前需要激活电池（BM3451初始状态时保护的，需要充一下电激活），不建议用另一个可调电源绕过sc8886直接给电池组充电，有概率击穿buck boost电路的MOSFET。
* 先装两个香蕉插头和按钮，然后先把香蕉插头和按钮背面的线先接好，按钮需要先焊线，需要一个单头的XH2.54- 4P的线，原理图上对应的按键接口中，VOUT和PGND连接到按钮的LED两个引脚（注意是有极性的），KEY和AGND连接到按钮的一组常开触点上，按键的插口在靠近输出的那个XT30接口的位置；
* PCB上另一个xh2.54-4P的针座和SK250C背后的串口接口相连，需要xh2.54-4P的同向双头线，长度10cm左右即可
* 接线示意图：

![1748236317986.jpg](https://image.lceda.cn/oshwhub/pullImage/98c144fcc6b748ca96a9f34d70833a4b.jpg)


![1748236317947.jpg](https://image.lceda.cn/oshwhub/pullImage/025024f7e2c44404862710f932822474.jpg)
* 风扇应该用四个M2.5的螺丝固定上去，但是手头没有就直接热熔胶打上去了
* 里面的螺母不好上，可以先用热熔胶固定到指定位置然后直接拧上螺丝

## 一些物料购买链接
   购买链接仅供参考
* SK150C本体：【淘宝】7天无理由退货 https://e.tb.cn/h.6ML17TWPs9Xl9DF?tk=FDHNV59dC1k tG-#22>lD 「SK150C彩屏数控升降压可调直流稳压电源恒压恒流充电模块40V8A」
* 香蕉插座：【淘宝】假一赔四 https://e.tb.cn/h.6MMF2UE5su34TOE?tk=g2IlV59WM2k CZ225 「高压安全型4mm孔面板香蕉插座孔电流32a接线柱连接器焊接式」
* 带LED按钮：【淘宝】7天无理由退货 https://e.tb.cn/h.6MMttoUPJefJ3lp?tk=OGdbV592zLV MF287 「12/16/19/22MM超短金属复位按钮 轻触开关带灯超薄微行程电动开关」
这个选12mm 蓝色环形电源灯


## 实物图
串口输出的内容展示
VBUS是输入电压，VSYS是输出电压，VBAT是电池电压IIN是从适配器输入的电流ICHG是电池充电电流，IDCHG是电池放电电流 CMPIN是sc8886S的独立比较器输入电压，没什么关系。
![屏幕截图 2025-05-05 172927.png](https://image.lceda.cn/oshwhub/pullImage/42b6cc3dea4d403bad1e2d3900679f66.png)
图1：stm32输出的内容展示


成品展示：

![1748234804074.jpg](https://image.lceda.cn/oshwhub/pullImage/e373c098e3ec4c03916e6468094f39e1.jpg)

![1748234804050.jpg](https://image.lceda.cn/oshwhub/pullImage/29cc75d9957d42678025b6f5413a8d59.jpg)

![1748234804060.jpg](https://image.lceda.cn/oshwhub/pullImage/ff4741140d49451dbbc82a5d2f445e91.jpg)
